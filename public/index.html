<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HA Admin | Cockpit Elite V8.0 Cloud</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap');
        body { background-color: #020617; color: #f1f5f9; font-family: 'Inter', sans-serif; overflow-x: hidden; }
        .glass-card { background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(16px); border: 1px solid rgba(255,255,255,0.05); }
        .tab-active { color: #3b82f6 !important; border-bottom: 4px solid #3b82f6; background: linear-gradient(to bottom, transparent, rgba(59, 130, 246, 0.08)); }
        .input-dark { background: rgba(15, 23, 42, 0.8); border: 1px solid rgba(255,255,255,0.1); color: white; outline: none; padding: 1.25rem; border-radius: 1.25rem; width: 100%; font-weight: bold; transition: all 0.3s; }
        .input-dark:focus { border-color: #3b82f6; box-shadow: 0 0 15px rgba(59,130,246,0.2); }
        .img-dossie { transition: all 0.3s ease; filter: brightness(0.8); background-color: #020617; min-height: 80px; border: 2px solid transparent; object-fit: cover; cursor: pointer; }
        .img-dossie:hover { filter: brightness(1.1); border-color: #3b82f6; transform: scale(1.05); }
        .modal-blur { backdrop-filter: blur(25px); background: rgba(2, 6, 23, 0.95); }
        @keyframes slideUp { from { transform: translateY(30px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .animate-up { animation: slideUp 0.4s cubic-bezier(0, 0, 0.2, 1); }
        #toast { position: fixed; bottom: 2rem; right: 2rem; z-index: 500; display: none; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="min-h-screen pb-12 relative">

    <!-- TELA DE LOGIN (BARREIRA DE SEGURANÇA SUPABASE) -->
    <div id="loginScreen" class="fixed inset-0 z-[999] flex items-center justify-center bg-[#020617] animate-up">
        <div class="glass-card w-full max-w-sm rounded-[3rem] p-10 border-t-4 border-blue-500 shadow-2xl text-center relative overflow-hidden">
            <div class="absolute -top-20 -right-20 w-40 h-40 bg-blue-600/20 blur-3xl rounded-full"></div>
            <i class="fa-solid fa-lock text-5xl text-blue-500 mb-6 drop-shadow-[0_0_15px_rgba(59,130,246,0.5)]"></i>
            <h2 class="text-3xl font-black text-white italic uppercase tracking-tighter mb-2">HA Elite</h2>
            <p class="text-[10px] font-black uppercase text-slate-500 tracking-[0.3em] mb-8">Acesso Restrito</p>
            
            <div class="space-y-4">
                <input type="email" id="loginUser" placeholder="E-mail (Supabase)" class="input-dark text-center tracking-widest text-sm" onkeydown="if(event.key === 'Enter') document.getElementById('loginPass').focus()">
                <input type="password" id="loginPass" placeholder="Senha" class="input-dark text-center tracking-widest text-sm" onkeydown="if(event.key === 'Enter') efetuarLogin()">
                <button id="btnLoginAction" onclick="efetuarLogin()" class="w-full bg-blue-600 hover:bg-blue-500 py-5 rounded-3xl font-black uppercase text-xs shadow-[0_0_20px_rgba(59,130,246,0.4)] transition-all mt-4 flex items-center justify-center gap-2 text-white">
                    Desbloquear Sistema <i class="fa-solid fa-arrow-right-to-bracket"></i>
                </button>
            </div>
            <p id="loginError" class="text-red-400 text-[10px] font-bold uppercase mt-4 hidden"></p>
        </div>
    </div>

    <!-- O PAINEL SÓ APARECE DEPOIS DO LOGIN -->
    <div id="appContent" class="hidden">
        
        <div id="toast" class="glass-card px-8 py-5 rounded-[2rem] border-l-4 border-blue-500 shadow-2xl flex items-center gap-4 animate-up">
            <i class="fa-solid fa-circle-check text-blue-500"></i>
            <p id="toastMsg" class="text-xs font-black uppercase tracking-widest italic"></p>
        </div>

        <header class="bg-slate-900/90 border-b border-slate-800 sticky top-0 z-50 p-5 backdrop-blur-xl">
            <div class="max-w-7xl mx-auto flex flex-wrap justify-between items-center gap-6">
                <div class="flex items-center gap-8">
                    <div class="flex flex-col">
                        <div class="flex items-center gap-3">
                            <h1 class="text-3xl font-black text-blue-500 uppercase tracking-tighter italic">HA ELITE</h1>
                            <div id="zapiStatus" class="flex items-center gap-2 px-3 py-1 rounded-full bg-slate-800/80 border border-slate-700">
                                <div id="zapiDot" class="w-2 h-2 rounded-full bg-red-500"></div>
                                <span id="zapiText" class="text-[8px] font-black uppercase text-slate-500 tracking-widest">Z-API OFFLINE</span>
                            </div>
                        </div>
                        <span class="text-[9px] font-bold text-slate-500 uppercase tracking-[0.4em] mt-1">Cloud Edition V8.0</span>
                    </div>
                </div>
                <div class="flex gap-8 items-center text-right">
                    <div><p class="text-[10px] text-slate-500 font-black uppercase tracking-widest mb-1">Na Rua</p><p id="dashNaRua" class="text-3xl font-black text-white italic tracking-tighter">R$ 0,00</p></div>
                    <div class="border-l border-slate-800 pl-8"><p class="text-[10px] text-emerald-500 font-black uppercase tracking-widest mb-1">Lucro Realizado</p><p id="dashRecebido" class="text-3xl font-black text-emerald-400 italic tracking-tighter">R$ 0,00</p></div>
                    <button onclick="abrirConfiguracoes()" class="ml-4 bg-slate-800 p-4 rounded-[1.5rem] hover:bg-slate-700 hover:text-blue-400 transition-all text-slate-400 border border-slate-700 shadow-lg">
                        <i class="fa-solid fa-gear text-xl"></i>
                    </button>
                    <button onclick="sair()" class="bg-red-500/10 p-4 rounded-[1.5rem] hover:bg-red-500 hover:text-white transition-all text-red-500 border border-red-500/20 shadow-lg ml-2" title="Sair do Sistema">
                        <i class="fa-solid fa-power-off text-xl"></i>
                    </button>
                </div>
            </div>
        </header>

        <nav class="bg-slate-900/50 flex gap-2 px-8 border-b border-slate-800 overflow-x-auto no-scrollbar">
            <button onclick="mudarAba('dashboard')" id="nav-dashboard" class="py-6 px-8 text-[11px] font-black uppercase tab-active tracking-widest whitespace-nowrap">Painel</button>
            <button onclick="mudarAba('solicitacoes')" id="nav-solicitacoes" class="py-6 px-8 text-[11px] font-black uppercase text-slate-500 tracking-widest relative whitespace-nowrap">Análises</button>
            <button onclick="mudarAba('aberto')" id="nav-aberto" class="py-6 px-8 text-[11px] font-black uppercase text-slate-500 tracking-widest whitespace-nowrap">Cobranças Ativas</button>
            <button onclick="mudarAba('clientes')" id="nav-clientes" class="py-6 px-8 text-[11px] font-black uppercase text-slate-500 tracking-widest whitespace-nowrap">Auditoria</button>
            <button onclick="mudarAba('relatorios')" id="nav-relatorios" class="py-6 px-8 text-[11px] font-black uppercase text-purple-400 tracking-widest hover:bg-purple-500/10 transition-colors whitespace-nowrap">Relatórios</button>
            <button onclick="mudarAba('migracao')" id="nav-migracao" class="py-6 px-8 text-[11px] font-black uppercase text-orange-400 tracking-widest hover:bg-orange-500/10 transition-colors whitespace-nowrap">Migração</button>
            <button onclick="mudarAba('ranking')" id="nav-ranking" class="py-6 px-8 text-[11px] font-black uppercase text-slate-500 tracking-widest whitespace-nowrap">Promotores</button>
            <button onclick="mudarAba('lista-negra')" id="nav-lista-negra" class="py-6 px-8 text-[11px] font-black uppercase text-red-500/70 tracking-widest whitespace-nowrap">Blacklist</button>
        </nav>

        <main class="max-w-7xl mx-auto p-10">
            <!-- DASHBOARD -->
            <section id="aba-dashboard" class="aba-content animate-up space-y-8">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <div class="glass-card p-10 rounded-[3rem] border-b-4 border-blue-500"><p class="text-[10px] font-black uppercase text-slate-500 tracking-widest mb-2">Balanço Disponível</p><h3 id="dashDisponivelCard" class="text-4xl font-black text-white italic">R$ 0,00</h3></div>
                    <div class="glass-card p-10 rounded-[3rem] border-b-4 border-emerald-500"><p class="text-[10px] font-black uppercase text-slate-500 tracking-widest mb-2">Rentabilidade Base</p><h3 id="lucroEst" class="text-4xl font-black text-emerald-400 italic">R$ 0,00</h3></div>
                    <div class="glass-card p-10 rounded-[3rem] border-b-4 border-purple-500 flex items-center justify-between"><div><p class="text-[10px] font-black uppercase text-slate-500 tracking-widest mb-2">WhatsApp</p><h3 id="zapTxt" class="text-xl font-black text-white italic">Verificando...</h3></div><i class="fa-solid fa-robot text-purple-500 text-3xl"></i></div>
                </div>
                <div class="glass-card p-12 rounded-[4rem] border border-slate-800 shadow-2xl h-[450px]"><canvas id="mainChart"></canvas></div>
            </section>

            <!-- RELATÓRIOS -->
            <section id="aba-relatorios" class="aba-content hidden space-y-8 animate-up">
                <div class="flex gap-4 mb-4">
                    <button id="btnFiltromes" onclick="setFiltroRelatorio('mes')" class="btn-filtro bg-slate-800/80 hover:bg-slate-700 px-6 py-3 rounded-2xl text-[10px] font-black uppercase text-slate-400 tracking-widest border border-white/5 transition-all">Este Mês</button>
                    <button id="btnFiltrotri" onclick="setFiltroRelatorio('tri')" class="btn-filtro bg-slate-800/80 hover:bg-slate-700 px-6 py-3 rounded-2xl text-[10px] font-black uppercase text-slate-400 tracking-widest border border-white/5 transition-all">Trimestre</button>
                    <button id="btnFiltroano" onclick="setFiltroRelatorio('ano')" class="btn-filtro bg-slate-800/80 hover:bg-slate-700 px-6 py-3 rounded-2xl text-[10px] font-black uppercase text-slate-400 tracking-widest border border-white/5 transition-all">Este Ano</button>
                </div>
                <div class="glass-card p-10 rounded-[3rem] border border-slate-700/50 flex flex-col md:flex-row gap-6 items-end shadow-xl">
                    <div class="flex-1 w-full"><label class="text-[10px] uppercase font-black text-slate-500 tracking-widest ml-2">Data Início</label><input type="date" id="relDataInicio" class="input-dark mt-1 text-sm text-center text-blue-400"></div>
                    <div class="flex-1 w-full"><label class="text-[10px] uppercase font-black text-slate-500 tracking-widest ml-2">Data Fim</label><input type="date" id="relDataFim" class="input-dark mt-1 text-sm text-center text-blue-400"></div>
                    <button id="btnFiltrarRel" onclick="gerarRelatorioPeriodo()" class="w-full md:w-auto bg-purple-600 hover:bg-purple-500 px-10 py-5 rounded-3xl font-black uppercase text-xs shadow-lg transition-all h-[72px] flex items-center justify-center whitespace-nowrap text-white"><i class="fa-solid fa-filter mr-2"></i> Filtrar Período</button>
                </div>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 hidden" id="boxResultadosRelatorio">
                    <div class="bg-slate-900/80 p-6 rounded-[2.5rem] border-t-4 border-blue-500 shadow-xl"><p class="text-[9px] font-black uppercase text-slate-500 tracking-widest mb-1">Total Emprestado</p><h3 id="relTotEmprestado" class="text-2xl font-black text-white italic tracking-tighter">R$ 0,00</h3></div>
                    <div class="bg-slate-900/80 p-6 rounded-[2.5rem] border-t-4 border-emerald-500 shadow-xl"><p class="text-[9px] font-black uppercase text-emerald-500 tracking-widest mb-1">Lucro (Juros Pagos)</p><h3 id="relTotRecebido" class="text-2xl font-black text-emerald-400 italic tracking-tighter">R$ 0,00</h3></div>
                    <div class="bg-slate-900/80 p-6 rounded-[2.5rem] border-t-4 border-orange-500 shadow-xl"><p class="text-[9px] font-black uppercase text-orange-500 tracking-widest mb-1">Multas de Atraso</p><h3 id="relJurosAtraso" class="text-2xl font-black text-orange-400 italic tracking-tighter">R$ 0,00</h3></div>
                    <div class="bg-slate-900/80 p-6 rounded-[2.5rem] border-t-4 border-red-500 shadow-xl text-center"><p class="text-[9px] font-black uppercase text-red-500 tracking-widest mb-1">Dívidas Atrasadas</p><h3 id="relQtdAtrasados" class="text-3xl font-black text-red-500 italic">0</h3></div>
                    <div class="col-span-2 bg-slate-900/80 p-6 rounded-[2.5rem] border border-white/5 flex items-center justify-between"><div class="text-left"><p class="text-[9px] font-black uppercase text-slate-500 tracking-widest">Contratos Aprovados</p><h3 id="relQtdEmprestimos" class="text-3xl font-black text-blue-400 italic mt-1">0</h3></div><i class="fa-solid fa-file-signature text-4xl text-blue-500/20"></i></div>
                    <div class="col-span-2 bg-slate-900/80 p-6 rounded-[2.5rem] border border-white/5 flex items-center justify-between"><div class="text-left"><p class="text-[9px] font-black uppercase text-slate-500 tracking-widest">Bloqueios Blacklist</p><h3 id="relQtdBloqueados" class="text-3xl font-black text-slate-600 italic mt-1">0</h3></div><i class="fa-solid fa-ban text-4xl text-slate-600/20"></i></div>
                </div>
            </section>

            <!-- MIGRAÇÃO -->
            <section id="aba-migracao" class="aba-content hidden space-y-6 animate-up">
                <div class="glass-card p-12 rounded-[4rem] border border-orange-500/20 shadow-2xl max-w-4xl mx-auto">
                    <div class="text-center mb-10"><h2 class="text-3xl font-black text-orange-500 uppercase italic">Migração de Contrato</h2></div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div><label class="text-[9px] uppercase font-black text-slate-500 tracking-widest ml-2">Nome Completo</label><input type="text" id="m_nome" class="input-dark mt-1"></div>
                        <div><label class="text-[9px] uppercase font-black text-slate-500 tracking-widest ml-2">CPF</label><input type="text" id="m_cpf" class="input-dark mt-1"></div>
                        <div><label class="text-[9px] uppercase font-black text-slate-500 tracking-widest ml-2">WhatsApp</label><input type="text" id="m_zap" class="input-dark mt-1"></div>
                        <div><label class="text-[9px] uppercase font-black text-slate-500 tracking-widest ml-2">Data Vencimento</label><input type="date" id="m_venc" class="input-dark mt-1 text-sm"></div>
                        <div><label class="text-[9px] uppercase font-black text-slate-500 tracking-widest ml-2">Valor Emprestado (R$)</label><input type="number" id="m_orig" class="input-dark mt-1 text-blue-400"></div>
                        <div><label class="text-[9px] uppercase font-black text-slate-500 tracking-widest ml-2">Saldo Atual (R$)</label><input type="number" id="m_atual" class="input-dark mt-1 text-emerald-400"></div>
                    </div>
                    <button onclick="confirmarMigracao()" class="w-full bg-orange-600 hover:bg-orange-500 py-6 rounded-[2.5rem] font-black uppercase text-xs mt-10 text-white shadow-xl transition-all">Sincronizar <i class="fa-solid fa-cloud-arrow-up ml-2"></i></button>
                </div>
            </section>

            <section id="aba-solicitacoes" class="aba-content hidden grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 animate-up"></section>
            <section id="aba-aberto" class="aba-content hidden grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-8 animate-up"></section>

            <!-- AUDITORES (CLIENTES) -->
            <section id="aba-clientes" class="aba-content hidden animate-up">
                <div class="glass-card p-12 rounded-[4rem] border border-slate-800 shadow-2xl">
                    <input type="text" id="buscaCliente" oninput="filtrarClientes()" placeholder="Filtrar por nome ou CPF..." class="w-full bg-slate-950/50 p-7 rounded-[2.5rem] border border-slate-800 font-bold outline-none mb-10 text-xl text-white focus:border-blue-500 transition-all">
                    <div id="listaAuditores" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div>
                </div>
            </section>

            <!-- BLACKLIST -->
            <section id="aba-lista-negra" class="aba-content hidden space-y-10 animate-up">
                <div class="glass-card p-12 rounded-[4rem] border border-red-500/20 shadow-2xl">
                    <div class="flex flex-wrap gap-6">
                        <input type="text" id="lnCpf" placeholder="CPF Alvo" class="flex-1 input-dark">
                        <input type="text" id="lnMotivo" placeholder="Motivo do Bloqueio" class="input-dark flex-1">
                        <button onclick="bloquearCpf()" class="bg-red-600 hover:bg-red-500 px-12 rounded-3xl font-black uppercase text-white transition-all shadow-xl">Banir CPF</button>
                    </div>
                </div>
                <div id="containerListaNegra" class="grid grid-cols-1 md:grid-cols-3 gap-6"></div>
            </section>

            <!-- RANKING -->
            <section id="aba-ranking" class="aba-content hidden space-y-6 animate-up">
                <div class="glass-card p-10 rounded-[3rem] grid grid-cols-1 md:grid-cols-3 gap-6 mb-10 shadow-2xl">
                    <input type="text" id="p_cpf" placeholder="CPF do Promotor" class="input-dark">
                    <input type="text" id="p_nome" placeholder="Nome para o Ranking" class="input-dark">
                    <button onclick="salvarPromotor()" class="bg-blue-600 hover:bg-blue-500 rounded-[1.25rem] text-white font-black uppercase transition-all shadow-xl">Vincular Parceiro</button>
                </div>
                <div id="listaRanking" class="space-y-6"></div>
            </section>
        </main>

        <!-- ========================================== -->
        <!-- MODAIS DE AÇÃO DO SISTEMA -->
        <!-- ========================================== -->

        <!-- MODAL CONFIGURAÇÕES -->
        <div id="modalConfiguracoes" class="fixed inset-0 z-[150] hidden flex items-center justify-center p-6 modal-blur">
            <div class="bg-slate-900 w-full max-w-md rounded-[3rem] p-10 border border-blue-500/20 shadow-3xl animate-up relative">
                <button onclick="fecharModais()" class="absolute top-6 right-6 text-slate-400 hover:text-red-500 transition-all"><i class="fa-solid fa-xmark text-xl"></i></button>
                <div class="text-center mb-6">
                    <i class="fa-solid fa-sliders text-4xl text-blue-500 mb-4 drop-shadow-[0_0_10px_rgba(59,130,246,0.3)]"></i>
                    <h3 class="text-2xl font-black text-white italic uppercase tracking-tighter">Configurações</h3>
                </div>
                <div class="space-y-4">
                    <div>
                        <label class="text-[9px] uppercase font-black text-blue-400 tracking-widest ml-2">Fundo de Caixa Total (R$)</label>
                        <input type="number" id="confCaixa" class="input-dark mt-1 text-center text-blue-400 text-xl">
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="text-[9px] uppercase font-black text-slate-500 tracking-widest ml-2">Juros (30 Dias) %</label>
                            <input type="number" id="confTaxa30" class="input-dark mt-1 text-center">
                        </div>
                        <div>
                            <label class="text-[9px] uppercase font-black text-slate-500 tracking-widest ml-2">Juros (Parcelado) %</label>
                            <input type="number" id="confTaxaParc" class="input-dark mt-1 text-center">
                        </div>
                    </div>
                    <button onclick="salvarConfiguracoes()" class="w-full bg-blue-600 hover:bg-blue-500 py-6 rounded-[2rem] font-black uppercase text-xs shadow-xl transition-all text-white flex items-center justify-center gap-2">Salvar Definições <i class="fa-solid fa-check"></i></button>
                </div>
            </div>
        </div>

        <!-- MODAL GERENCIAR CONTRATO -->
        <div id="modalGerenciar" class="fixed inset-0 z-[120] hidden flex items-center justify-center p-6 modal-blur overflow-y-auto">
            <div class="bg-slate-900 w-full max-w-lg rounded-[4rem] p-10 border border-slate-700 shadow-3xl animate-up relative">
                <button onclick="fecharModais()" class="absolute top-8 right-8 text-slate-400 hover:text-red-500 transition-all"><i class="fa-solid fa-xmark text-2xl"></i></button>
                <h2 class="text-3xl font-black text-blue-500 uppercase italic mb-2">Ação Tática</h2>
                <p id="gerenciar-nome" class="text-xs text-slate-500 font-bold uppercase tracking-widest mb-6"></p>

                <div class="space-y-6">
                    <div>
                        <label class="text-[9px] uppercase font-black text-slate-500 tracking-widest ml-2">Operação do Contrato</label>
                        <select id="tipoAcaoGerenciar" onchange="mudarAcaoGerenciar()" class="input-dark mt-1 text-sm text-center">
                            <option value="">-- Selecione --</option>
                            <option value="BAIXA">Pagamento Parcial (Manual)</option>
                            <option value="ADIAR">Prorrogar Vencimento</option>
                            <option value="RENEGOCIAR">Renegociar Saldo Total</option>
                            <option value="QUITAR">Liquidação / Quitação Total</option>
                        </select>
                    </div>

                    <div id="view-BAIXA" class="gerenciar-view hidden space-y-4 bg-slate-800/50 p-6 rounded-3xl border border-white/5"><label class="text-[9px] uppercase font-black text-emerald-400 tracking-widest ml-2">Valor Recebido (R$)</label><input type="number" id="g_valorBaixa" placeholder="Ex: 50.00" class="input-dark text-center text-emerald-400 text-xl"></div>
                    <div id="view-ADIAR" class="gerenciar-view hidden grid grid-cols-2 gap-4 bg-slate-800/50 p-6 rounded-3xl border border-white/5"><div><label class="text-[8px] font-black uppercase text-slate-400 ml-2">Nova Data</label><input type="date" id="g_novaData" class="input-dark mt-1 text-xs"></div><div><label class="text-[8px] font-black uppercase text-slate-400 ml-2">Multa Adicional</label><input type="number" id="g_diaria" placeholder="R$ 0,00" class="input-dark mt-1 text-xs text-center"></div></div>
                    <div id="view-RENEGOCIAR" class="gerenciar-view hidden space-y-4 bg-slate-800/50 p-6 rounded-3xl border border-white/5"><label class="text-[9px] uppercase font-black text-purple-400 tracking-widest ml-2">Novo Saldo Total (R$)</label><input type="number" id="g_novoValor" placeholder="R$ 0,00" class="input-dark text-center text-purple-400 text-xl"><div class="grid grid-cols-2 gap-4"><select id="g_novaFreq" class="input-dark text-xs"><option value="MENSAL">Mensal</option><option value="SEMANAL">Semanal</option></select><input type="number" id="g_novasParc" placeholder="Parcelas" class="input-dark text-center text-xs"></div></div>
                    <div id="view-QUITAR" class="gerenciar-view hidden text-center bg-slate-800/50 p-6 rounded-3xl border border-emerald-500/20"><i class="fa-solid fa-check-double text-4xl text-emerald-500 mb-2 drop-shadow-[0_0_10px_rgba(16,185,129,0.3)]"></i><p class="text-sm font-black text-white uppercase italic tracking-widest">Encerrar Contrato</p></div>

                    <button id="btnExecGerenciar" onclick="executarGerenciar()" class="w-full bg-blue-600 hover:bg-blue-500 py-6 rounded-[2.5rem] font-black uppercase text-xs text-white hidden shadow-xl transition-all flex items-center justify-center gap-2">Confirmar Operação <i class="fa-solid fa-bolt"></i></button>
                </div>
            </div>
        </div>

        <!-- MODAL RELATORIO DOSSIÊ -->
        <div id="modalRelatorio" class="fixed inset-0 z-[110] hidden flex items-center justify-center p-6 modal-blur">
            <div class="bg-slate-900 w-full max-w-6xl rounded-[4rem] p-12 border border-slate-700 max-h-[95vh] overflow-y-auto shadow-3xl animate-up">
                <div class="flex justify-between items-center mb-10">
                    <div><h2 id="rel-nome" class="text-4xl font-black text-blue-500 uppercase italic tracking-tighter"></h2><p id="rel-cpf-view" class="text-[10px] text-slate-500 font-black mt-2 flex items-center gap-2 tracking-widest"></p></div>
                    <div class="flex gap-3">
                        <button onclick="abrirZapCustom()" class="bg-emerald-600 hover:bg-emerald-500 px-8 py-4 rounded-3xl font-black uppercase text-xs text-white transition-all shadow-xl flex items-center gap-2"><i class="fa-brands fa-whatsapp text-lg"></i> Falar</button>
                        <button onclick="fecharModais()" class="bg-slate-800 hover:bg-red-500 transition-colors p-4 rounded-3xl text-white"><i class="fa-solid fa-xmark text-xl px-2"></i></button>
                    </div>
                </div>
                
                <p class="text-[9px] font-black uppercase text-slate-600 tracking-widest mb-3 ml-2">Histórico Vitalício</p>
                <div id="rel-stats" class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center mb-10"></div>
                
                <p class="text-[9px] font-black uppercase text-slate-600 tracking-widest mb-3 ml-2">Dossiê e Referências</p>
                <div id="rel-dossie" class="bg-slate-950/60 p-8 rounded-[3rem] mb-10 space-y-6 border border-slate-800">
                    <div class="grid grid-cols-2 gap-4 text-xs">
                        <div class="bg-slate-900/50 p-4 rounded-2xl border border-white/5"><span class="block text-[8px] text-slate-500 uppercase font-black mb-1">Ref 1</span><span id="v_ref1_nome" class="text-white font-bold block truncate"></span><span id="v_ref1_tel" class="text-blue-400 font-black block mt-1"></span></div>
                        <div class="bg-slate-900/50 p-4 rounded-2xl border border-white/5"><span class="block text-[8px] text-slate-500 uppercase font-black mb-1">Ref 2</span><span id="v_ref2_nome" class="text-white font-bold block truncate"></span><span id="v_ref2_tel" class="text-blue-400 font-black block mt-1"></span></div>
                    </div>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div class="text-center bg-slate-900/50 p-3 rounded-3xl"><span class="text-[8px] text-slate-500 uppercase font-black mb-2 block">Selfie</span><img id="v_img_s" class="w-full h-24 rounded-2xl img-dossie object-cover" onclick="window.open(this.src)"></div>
                        <div class="text-center bg-slate-900/50 p-3 rounded-3xl"><span class="text-[8px] text-slate-500 uppercase font-black mb-2 block">Documento</span><img id="v_img_d" class="w-full h-24 rounded-2xl img-dossie object-cover" onclick="window.open(this.src)"></div>
                        <div class="text-center bg-slate-900/50 p-3 rounded-3xl"><span class="text-[8px] text-slate-500 uppercase font-black mb-2 block">Residência</span><img id="v_img_r" class="w-full h-24 rounded-2xl img-dossie object-cover" onclick="window.open(this.src)"></div>
                        <div class="text-center bg-slate-900/50 p-3 rounded-3xl"><span class="text-[8px] text-slate-500 uppercase font-black mb-2 block">Casa</span><img id="v_img_c" class="w-full h-24 rounded-2xl img-dossie object-cover" onclick="window.open(this.src)"></div>
                    </div>
                </div>
                
                <p class="text-[9px] font-black uppercase text-slate-600 tracking-widest mb-3 ml-2">Timeline de Eventos</p>
                <div id="rel-logs" class="space-y-3 bg-slate-950/60 p-8 rounded-[3rem] border border-slate-800"></div>
            </div>
        </div>

        <!-- MODAL CONTRA PROPOSTA -->
        <div id="modalContraProposta" class="fixed inset-0 z-[130] hidden flex items-center justify-center p-6 modal-blur">
            <div class="bg-slate-900 w-full max-w-md rounded-[3rem] p-10 border border-orange-500/50 shadow-3xl animate-up relative">
                <button onclick="fecharModais()" class="absolute top-6 right-6 text-slate-400 hover:text-red-500 transition-colors"><i class="fa-solid fa-xmark text-xl"></i></button>
                <div class="text-center mb-6">
                    <i class="fa-solid fa-comments-dollar text-4xl text-orange-500 mb-4 drop-shadow-[0_0_15px_rgba(249,115,22,0.4)]"></i>
                    <h3 class="text-2xl font-black text-white italic uppercase tracking-tighter">Contra-Proposta</h3>
                    <p id="cpNomeCliente" class="text-[10px] text-slate-400 uppercase font-bold mt-1 tracking-widest"></p>
                </div>
                <div class="space-y-4">
                    <div><label class="text-[9px] uppercase font-black text-slate-500 tracking-widest ml-2">Pedido Original</label><input type="text" id="cpValorOriginal" class="input-dark mt-1 text-center opacity-50 cursor-not-allowed" disabled></div>
                    <div><label class="text-[9px] uppercase font-black text-orange-400 tracking-widest ml-2">Nova Oferta (R$)</label><input type="number" id="cpNovoValor" placeholder="Ex: 1000" class="input-dark mt-1 text-center text-orange-400 text-2xl focus:border-orange-500"></div>
                    <button id="btnConfirmaCP" onclick="confirmarContraProposta()" class="w-full bg-orange-600 hover:bg-orange-500 transition-all py-6 rounded-[2rem] font-black uppercase text-xs text-white shadow-xl flex items-center justify-center gap-2">Aprovar e Gerar Link <i class="fa-brands fa-whatsapp text-lg"></i></button>
                </div>
            </div>
        </div>

        <!-- MODAL APROVAR SOLICITAÇÃO (DADOS DA ANÁLISE) -->
        <div id="modalAprovar" class="fixed inset-0 z-[100] hidden flex items-center justify-center p-6 modal-blur overflow-y-auto">
            <div class="bg-slate-900 w-full max-w-7xl rounded-[5rem] p-12 border border-slate-700 shadow-3xl animate-up relative mt-20 md:mt-0">
                <button onclick="fecharModais()" class="absolute top-10 right-10 bg-slate-800 p-5 rounded-full text-white hover:bg-red-500 transition-colors z-10"><i class="fa-solid fa-xmark"></i></button>
                
                <div class="grid grid-cols-1 lg:grid-cols-12 gap-12">
                    <div class="lg:col-span-5 space-y-6">
                        <div><h3 id="detNome" class="text-3xl font-black text-blue-500 uppercase italic truncate tracking-tighter"></h3><p id="detCpf" class="text-[10px] text-slate-500 font-black mt-2 tracking-widest"></p></div>
                        
                        <div class="bg-blue-900/20 p-5 rounded-[2rem] border border-blue-500/20"><span class="text-[9px] font-black text-blue-400 uppercase tracking-widest block mb-1">Indicado Por</span><input type="text" id="detIndicador" class="bg-transparent text-white font-black text-sm outline-none uppercase w-full" disabled></div>
                        
                        <div class="grid grid-cols-2 gap-3 text-xs bg-slate-900/50 p-5 rounded-[2rem] border border-white/5">
                            <div class="bg-slate-950/50 p-3 rounded-2xl"><span class="block text-[8px] text-slate-600 uppercase font-black mb-1">Ref 1</span><span id="detRef1Nome" class="text-white font-bold block truncate"></span><span id="detRef1Tel" class="text-blue-400 font-black block mt-1"></span></div>
                            <div class="bg-slate-950/50 p-3 rounded-2xl"><span class="block text-[8px] text-slate-600 uppercase font-black mb-1">Ref 2</span><span id="detRef2Nome" class="text-white font-bold block truncate"></span><span id="detRef2Tel" class="text-blue-400 font-black block mt-1"></span></div>
                        </div>

                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                            <div class="text-center bg-slate-950/50 p-2 rounded-3xl"><span class="text-[7px] text-slate-500 uppercase font-black mb-1 block">Selfie</span><img id="imgS" class="w-full h-20 rounded-2xl img-dossie object-cover" onclick="window.open(this.src)"></div>
                            <div class="text-center bg-slate-950/50 p-2 rounded-3xl"><span class="text-[7px] text-slate-500 uppercase font-black mb-1 block">Doc</span><img id="imgD" class="w-full h-20 rounded-2xl img-dossie object-cover" onclick="window.open(this.src)"></div>
                            <div class="text-center bg-slate-950/50 p-2 rounded-3xl"><span class="text-[7px] text-slate-500 uppercase font-black mb-1 block">Comp</span><img id="imgR" class="w-full h-20 rounded-2xl img-dossie object-cover" onclick="window.open(this.src)"></div>
                            <div class="text-center bg-slate-950/50 p-2 rounded-3xl"><span class="text-[7px] text-slate-500 uppercase font-black mb-1 block">Casa</span><img id="imgC" class="w-full h-20 rounded-2xl img-dossie object-cover" onclick="window.open(this.src)"></div>
                        </div>
                    </div>

                    <div class="lg:col-span-7 flex flex-col justify-center">
                        <div class="bg-slate-800/60 p-10 rounded-[4rem] border border-slate-700/50 space-y-6 shadow-inner">
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                <div><span class="text-[8px] font-black text-slate-500 uppercase ml-2 tracking-widest">Capital (R$)</span><input type="number" id="negValor" oninput="recalcular()" class="input-dark text-center text-blue-500 mt-1"></div>
                                <div><span class="text-[8px] font-black text-slate-500 uppercase ml-2 tracking-widest">Juros (%)</span><input type="number" id="negTaxa" oninput="recalcular()" class="input-dark text-center text-emerald-400 mt-1"></div>
                                <div><span class="text-[8px] font-black text-slate-500 uppercase ml-2 tracking-widest">Freq</span><select id="negFrequencia" class="input-dark text-center text-xs px-2 mt-1"><option value="MENSAL">Mensal</option><option value="SEMANAL">Semanal</option><option value="QUINZENAL">Quinzenal</option></select></div>
                                <div><span class="text-[8px] font-black text-slate-500 uppercase ml-2 tracking-widest">Parc.</span><input type="number" id="negParcelas" oninput="recalcular()" class="input-dark text-center mt-1"></div>
                            </div>
                            
                            <div class="p-8 bg-blue-600/10 rounded-[3rem] grid grid-cols-2 gap-4 border border-blue-500/10">
                                <div class="text-center"><p class="text-[9px] text-blue-400 font-black uppercase tracking-widest">Total Final</p><h4 id="negTotalDisplay" class="text-4xl font-black text-white italic mt-1 tracking-tighter"></h4></div>
                                <div class="border-l border-blue-500/20 pl-4 text-center"><p class="text-[9px] text-emerald-400 font-black uppercase tracking-widest">Parcela</p><h4 id="negParcelaDisplay" class="text-4xl font-black text-emerald-400 italic mt-1 tracking-tighter"></h4></div>
                            </div>
                            
                            <div class="flex items-center gap-3 bg-slate-900/80 p-5 rounded-3xl border border-white/5 mt-4 shadow-inner">
                                <input type="checkbox" id="negZapLink" checked class="w-6 h-6 accent-blue-500 bg-slate-800 border-slate-700 cursor-pointer rounded">
                                <label for="negZapLink" class="text-[10px] uppercase font-black text-slate-400 tracking-widest cursor-pointer select-none">Enviar Notificação e Link via WhatsApp</label>
                            </div>
                            
                            <div class="space-y-3 mt-4">
                                <button id="btnAprovarOperacao" onclick="salvarNegociacaoUniversal()" class="w-full bg-blue-600 hover:bg-blue-500 py-6 rounded-[3rem] font-black uppercase text-sm text-white transition-all shadow-2xl flex items-center justify-center gap-2">Aprovar e Ativar Operação <i class="fa-solid fa-check-double"></i></button>
                                <div class="flex gap-3">
                                    <button onclick="abrirModalContraProposta()" class="flex-1 bg-orange-600/20 text-orange-500 border border-orange-500/30 hover:bg-orange-500 hover:text-white transition-colors py-4 rounded-[2rem] font-black uppercase text-[10px] flex items-center justify-center gap-2"><i class="fa-solid fa-comments-dollar"></i> Contra-Proposta</button>
                                    <button onclick="rejeitarSolicitacao()" class="flex-1 bg-red-600/20 text-red-500 border border-red-500/30 hover:bg-red-500 hover:text-white transition-colors py-4 rounded-[2rem] font-black uppercase text-[10px] flex items-center justify-center gap-2"><i class="fa-solid fa-trash"></i> Rejeitar</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div> <!-- FIM APP CONTENT -->

    <script>
        const API_BASE = window.location.origin;
        let todosAuditores = [];
        let pendentesAtuais = []; 
        let soliAtual = null;
        let auditorAtual = null;
        let ativosAtuais = [];
        let myChart = null;
        let contratoGerenciar = null;

        const formatBRL = (v) => Number(v).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
        const escapeHTML = (str) => { if (!str) return ''; return str.toString().replace(/[&<>'"]/g, tag => ({'&': '&amp;', '<': '&lt;', '>': '&gt;', "'": '&#39;', '"': '&quot;'}[tag])); };
        const imgFallback = 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="150" height="150"><rect width="150" height="150" fill="%230f172a"/><text x="50%" y="50%" fill="%233b82f6" font-size="12" font-family="sans-serif" font-weight="bold" text-anchor="middle" dominant-baseline="middle">FOTO</text></svg>';

        // ----------------------------------------------------
        // SISTEMA DE SEGURANÇA NO FRONTEND (INTERCEPTADOR)
        // ----------------------------------------------------
        const tokenAtivo = localStorage.getItem('ha_token');
        
        if (tokenAtivo) {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('appContent').classList.remove('hidden');
            iniciarSistema();
        }

        const originalFetch = window.fetch;
        window.fetch = async function() {
            let [resource, config] = arguments;
            if (resource.startsWith(API_BASE) && !resource.includes('/api/login')) {
                config = config || {};
                config.headers = config.headers || {};
                const token = localStorage.getItem('ha_token');
                if(token) config.headers['Authorization'] = `Bearer ${token}`;
            }
            
            const res = await originalFetch(resource, config);
            
            if (res.status === 401) {
                sair();
            }
            return res;
        };

        async function efetuarLogin() {
            const u = document.getElementById('loginUser').value;
            const p = document.getElementById('loginPass').value;
            const errEl = document.getElementById('loginError');
            const btn = document.getElementById('btnLoginAction');
            
            if(!u || !p) {
                errEl.innerText = "Preencha o e-mail e a senha.";
                errEl.classList.remove('hidden');
                return;
            }

            btn.disabled = true;
            btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Conectando...';
            errEl.classList.add('hidden');
            
            try {
                const res = await originalFetch(`${API_BASE}/api/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email: u, password: p })
                });

                const data = await res.json();
                
                if (res.ok && data.token) {
                    localStorage.setItem('ha_token', data.token);
                    document.getElementById('loginScreen').classList.add('hidden');
                    document.getElementById('appContent').classList.remove('hidden');
                    iniciarSistema();
                } else {
                    errEl.innerText = data.erro || "Falha de Autenticação";
                    errEl.classList.remove('hidden');
                }
            } catch (e) {
                errEl.innerText = "Erro ao conectar com o Servidor";
                errEl.classList.remove('hidden');
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'Desbloquear Sistema <i class="fa-solid fa-arrow-right-to-bracket"></i>';
            }
        }

        function sair() {
            localStorage.removeItem('ha_token');
            document.getElementById('appContent').classList.add('hidden');
            document.getElementById('loginScreen').classList.remove('hidden');
        }

        function iniciarSistema() {
            mudarAba('dashboard'); 
            setInterval(checarZap, 30000); 
            checarZap(); 
        }

        // ----------------------------------------------------
        // RESTANTE DAS FUNÇÕES DO SISTEMA 
        // ----------------------------------------------------

        function showToast(msg, type = 'success') { 
            const t = document.getElementById('toast'); 
            t.className = `glass-card px-8 py-5 rounded-[2rem] border-l-4 ${type === 'error' ? 'border-red-500' : 'border-blue-500'} shadow-2xl flex items-center gap-4 animate-up z-[500]`;
            document.getElementById('toastMsg').innerText = msg; 
            t.style.display = 'flex'; 
            setTimeout(() => { t.style.display = 'none'; }, 4500); 
        }

        function fecharModais() { 
            document.querySelectorAll('.modal-blur').forEach(m => { m.classList.add('hidden'); }); 
        }
        
        async function checarZap() { 
            try { 
                const res = await fetch(`${API_BASE}/status-zapi`); 
                const data = await res.json(); 
                document.getElementById('zapiStatus').innerHTML = `<div class="w-2 h-2 rounded-full ${data.connected ? 'bg-emerald-500' : 'bg-red-500'}"></div><span class="text-[8px] font-black uppercase tracking-widest ${data.connected ? 'text-emerald-400' : 'text-slate-500'}">Z-API ${data.connected ? 'ONLINE' : 'OFFLINE'}</span>`; 
            } catch(e) {
                console.warn("Monitoramento Z-API sem resposta.");
            } 
        }

        async function carregarDash() {
            try {
                const [dRes, cRes] = await Promise.all([ fetch(`${API_BASE}/dashboard`), fetch(`${API_BASE}/obter-configuracoes`) ]);
                const d = await dRes.json(); const conf = await cRes.json();
                
                document.getElementById('dashNaRua').innerText = formatBRL(d.naRua); 
                document.getElementById('dashRecebido').innerText = formatBRL(d.recebido); 
                document.getElementById('lucroEst').innerText = formatBRL(d.recebido); 
                document.getElementById('dashDisponivelCard').innerText = formatBRL(conf.disponivel || 0);
                
                document.getElementById('confCaixa').value = conf.caixa_total || '';
                document.getElementById('confTaxa30').value = conf.taxa_30 || 30;
                document.getElementById('confTaxaParc').value = conf.taxa_parc || 25;
                
                const ctx = document.getElementById('mainChart').getContext('2d');
                if(myChart) myChart.destroy();
                
                myChart = new Chart(ctx, { type: 'line', data: { labels: ['Capital Emprestado', 'Lucro Realizado'], datasets: [{ label: 'Fluxo (R$)', data: [d.naRua, d.recebido], borderColor: '#3b82f6', backgroundColor: 'rgba(59, 130, 246, 0.1)', fill: true, tension: 0.4 }] }, options: { responsive: true, maintainAspectRatio: false } });
            } catch(e) {
                console.error("Falha ao atualizar Dashboard", e);
            }
        }

        function abrirConfiguracoes() { document.getElementById('modalConfiguracoes').classList.remove('hidden'); }

        async function salvarConfiguracoes() {
            try {
                await fetch(`${API_BASE}/salvar-configuracoes`, {
                    method: 'POST', headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ caixa_total: parseFloat(document.getElementById('confCaixa').value) || 0, taxa_30: parseFloat(document.getElementById('confTaxa30').value) || 30, taxa_parc: parseFloat(document.getElementById('confTaxaParc').value) || 25 })
                });
                showToast("Configurações atualizadas!"); fecharModais(); carregarDash();
            } catch (e) { showToast("Erro ao salvar configurações.", "error"); }
        }

        async function carregarSoli() { 
            try {
                const res = await fetch(`${API_BASE}/listar-solicitacoes/PENDENTE`); 
                const data = await res.json(); 
                
                pendentesAtuais = data; 

                const container = document.getElementById('aba-solicitacoes');
                if(data.length === 0) { 
                    container.innerHTML = `<div class="col-span-full py-40 flex justify-center"><p class="opacity-20 font-black uppercase tracking-[0.5em]">Sem solicitações pendentes</p></div>`; 
                    return; 
                }
                
                // CORREÇÃO CRÍTICA: O ${s.id} do Supabase é um UUID (ex: 482a-93...). 
                // Se faltar aspas, o JavaScript tenta ler como código e quebra com SyntaxError! 
                // Adicionadas as aspas simples: onclick="abrirAnalise('${s.id}')"
                container.innerHTML = data.map(s => `
                    <div class="glass-card p-10 rounded-[3rem] shadow-xl border border-white/5 relative overflow-hidden">
                        <div class="absolute top-0 right-0 w-20 h-20 bg-blue-500/10 rounded-bl-full"></div>
                        <h3 class="text-xl font-black text-white italic truncate">${escapeHTML(s.nome)}</h3>
                        <p class="text-blue-400 font-black text-3xl mt-1">${formatBRL(s.valor)}</p>
                        <button onclick="abrirAnalise('${s.id}')" class="w-full bg-blue-600 hover:bg-blue-500 transition-colors mt-6 py-4 rounded-2xl font-black text-xs uppercase text-white shadow-lg flex items-center justify-center gap-2">
                            <i class="fa-solid fa-file-signature"></i> Auditar Ficha
                        </button>
                    </div>
                `).join(''); 
            } catch(e) {
                console.error("Falha ao listar análises pendentes.", e);
                showToast("Falha de conexão", "error");
            }
        }

        function abrirAnalise(idFicha) { 
            const s = pendentesAtuais.find(f => f.id === idFicha);
            if (!s) return showToast("Ficha não encontrada na memória.", "error");

            soliAtual = s; 
            document.getElementById('detNome').innerText = escapeHTML(s.nome); 
            document.getElementById('detCpf').innerText = `CPF: ${escapeHTML(s.cpf)}`; 
            document.getElementById('detIndicador').value = escapeHTML(s.indicado_por) || 'DIRETO';
            document.getElementById('detRef1Nome').innerText = escapeHTML(s.referencia1_nome) || 'N/A';
            document.getElementById('detRef1Tel').innerText = escapeHTML(s.referencia1_tel) || 'N/A';
            document.getElementById('detRef2Nome').innerText = escapeHTML(s.referencia2_nome) || 'N/A';
            document.getElementById('detRef2Tel').innerText = escapeHTML(s.referencia2_tel) || 'N/A';

            document.getElementById('imgS').src = s.url_selfie || imgFallback;
            document.getElementById('imgD').src = s.url_documento || imgFallback;
            document.getElementById('imgR').src = s.url_residencia || imgFallback;
            document.getElementById('imgC').src = s.url_casa || imgFallback;

            document.getElementById('negValor').value = s.valor || 0; 
            const tipoPlano = s.tipo_plano || '30DIAS';
            let txRecomendada = tipoPlano === '30DIAS' ? document.getElementById('confTaxa30').value : document.getElementById('confTaxaParc').value;
            document.getElementById('negTaxa').value = s.juros_ajustado || txRecomendada || 30; 
            document.getElementById('negFrequencia').value = s.frequencia ? escapeHTML(s.frequencia).toUpperCase() : 'MENSAL';
            document.getElementById('negParcelas').value = tipoPlano === '30DIAS' ? 1 : (parseInt(s.qtd_parcelas) || 1);
            
            if(document.getElementById('negZapLink')) document.getElementById('negZapLink').checked = true;
            
            recalcular(); 
            document.getElementById('modalAprovar').classList.remove('hidden'); 
        }

        function recalcular() { 
            const v = parseFloat(document.getElementById('negValor').value) || 0; 
            const t = parseFloat(document.getElementById('negTaxa').value) || 0; 
            const p = parseInt(document.getElementById('negParcelas').value) || 1; 
            const total = Math.round((v * (1 + (t/100))) * 100) / 100; 
            document.getElementById('negTotalDisplay').innerText = formatBRL(total); 
            document.getElementById('negParcelaDisplay').innerText = formatBRL(total/p); 
        }

        async function salvarNegociacaoUniversal() { 
            const btn = document.getElementById('btnAprovarOperacao');
            btn.disabled = true; btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Processando...';
            try {
                const v = parseFloat(document.getElementById('negValor').value); const t = parseFloat(document.getElementById('negTaxa').value);
                const totalCalculado = Math.round((v * (1 + (t/100))) * 100) / 100;
                
                const enviarZapOpt = document.getElementById('negZapLink') ? document.getElementById('negZapLink').checked : true;
                
                const bodyDados = { ...soliAtual, valor_negociado: totalCalculado, juros_negociado: t, frequencia: document.getElementById('negFrequencia').value, qtd_parcelas: document.getElementById('negParcelas').value, enviar_zap: enviarZapOpt };
                const res = await fetch(`${API_BASE}/aprovar-solicitacao`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(bodyDados) });
                
                if(res.ok) { 
                    showToast("Contrato Aprovado!"); fecharModais(); carregarSoli(); carregarAberto(); 
                } else { 
                    throw new Error("Erro na solicitação"); 
                }
            } catch(e) { 
                showToast("Falha ao aprovar", "error"); 
            } finally {
                btn.disabled = false; btn.innerHTML = 'Aprovar e Ativar Operação <i class="fa-solid fa-check-double"></i>';
            }
        }

        function abrirModalContraProposta() { 
            if(!soliAtual) return; 
            document.getElementById('cpNomeCliente').innerText = `Cliente: ${escapeHTML(soliAtual.nome)}`; 
            document.getElementById('cpValorOriginal').value = formatBRL(soliAtual.valor); 
            document.getElementById('cpNovoValor').value = ''; 
            document.getElementById('modalContraProposta').classList.remove('hidden'); 
        }

        async function confirmarContraProposta() {
            const novoV = document.getElementById('cpNovoValor').value;
            const btn = document.getElementById('btnConfirmaCP');
            
            if(!novoV || novoV <= 0) return showToast("Valor inválido.", "error");
            
            btn.disabled = true; btn.innerHTML = 'Processando...';
            const t = parseFloat(document.getElementById('negTaxa').value) || 30;
            const totalCalculado = Math.round((novoV * (1 + (t/100))) * 100) / 100;
            const p = { ...soliAtual, valor: novoV, valor_negociado: totalCalculado, juros_negociado: t, frequencia: document.getElementById('negFrequencia').value, qtd_parcelas: document.getElementById('negParcelas').value };
            
            try {
                const res = await fetch(`${API_BASE}/enviar-contra-proposta`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(p) });
                if (res.ok) { 
                    showToast("Contra-proposta com Link enviada!"); fecharModais(); carregarSoli(); 
                } else { 
                    const err = await res.json(); throw new Error(err.erro || "Falha do servidor."); 
                }
            } catch(e) { 
                showToast(e.message, "error"); 
            } finally {
                btn.disabled = false; btn.innerHTML = 'Aprovar e Gerar Link <i class="fa-brands fa-whatsapp text-lg"></i>';
            }
        }

        async function rejeitarSolicitacao() {
            if(!confirm("Atenção: Deseja REJEITAR e banir esta ficha?")) return;
            try {
                const res = await fetch(`${API_BASE}/rejeitar-solicitacao`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ id: soliAtual.id }) });
                if (res.ok) { showToast("Ficha Rejeitada."); fecharModais(); carregarSoli(); } else { throw new Error(""); }
            } catch(e) { showToast("Erro ao rejeitar ficha.", "error"); }
        }

        async function carregarAberto() {
            try {
                const res = await fetch(`${API_BASE}/listar-financeiro/false`); ativosAtuais = await res.json();
                const container = document.getElementById('aba-aberto');
                if(ativosAtuais.length === 0) { 
                    container.innerHTML = `<div class="col-span-full py-40 flex justify-center"><p class="opacity-20 font-black uppercase tracking-[0.5em]">Tudo Liquidado / Nenhuma Cobrança</p></div>`; 
                    return; 
                }
                container.innerHTML = ativosAtuais.map(c => `
                    <div class="glass-card p-10 rounded-[3.5rem] border border-white/5 animate-up shadow-2xl relative">
                        <div class="flex justify-between items-start mb-4">
                            <h3 class="text-lg font-black text-white uppercase truncate w-40 italic tracking-tighter">${escapeHTML(c.nome)}</h3>
                            <span class="bg-blue-600/10 text-blue-400 px-3 py-1 rounded-full text-[8px] font-black uppercase italic border border-blue-500/20">${c.score || 500} PTS</span>
                        </div>
                        <div class="mb-8">
                            <p class="text-[8px] text-slate-500 font-bold uppercase tracking-widest italic mb-1">Vencimento: ${new Date(c.data_vencimento + 'T12:00:00Z').toLocaleDateString('pt-BR')}</p>
                            <p class="text-3xl font-black text-white italic tracking-tighter">${formatBRL(c.valor_total)}</p>
                            <p class="text-[8px] text-emerald-400 font-black uppercase mt-1">${c.qtd_parcelas}x ${escapeHTML(c.frequencia)}</p>
                        </div>
                        <div class="grid grid-cols-3 gap-3">
                            <button onclick="abrirRelatorio(${c.id})" class="bg-slate-800 py-4 rounded-2xl font-black uppercase text-[8px] hover:bg-slate-700 tracking-widest text-slate-300 flex flex-col items-center gap-1 transition-colors"><i class="fa-solid fa-folder-open text-base"></i> Dossiê</button>
                            <button onclick="abrirGerenciar(${c.id})" class="bg-blue-600 py-4 rounded-2xl font-black uppercase text-[8px] hover:bg-blue-500 tracking-widest text-white flex flex-col items-center gap-1 shadow-lg transition-colors"><i class="fa-solid fa-gears text-base"></i> Ação</button>
                            <button onclick="cobrarCliente(${c.id})" class="bg-orange-600 py-4 rounded-2xl font-black uppercase text-[8px] hover:bg-orange-500 tracking-widest text-white flex flex-col items-center gap-1 transition-colors"><i class="fa-brands fa-whatsapp text-base"></i> Cobrar</button>
                        </div>
                    </div>`).join('');
            } catch(e) {
                console.error("Falha ao carregar contratos", e);
            }
        }

        function abrirGerenciar(id) { 
            contratoGerenciar = ativosAtuais.find(c => c.id === id); 
            // RESTAURAÇÃO: Mostrando o saldo no cabeçalho
            document.getElementById('gerenciar-nome').innerText = `Gestão: ${escapeHTML(contratoGerenciar.nome)} | Saldo: ${formatBRL(contratoGerenciar.valor_total)}`; 
            document.getElementById('tipoAcaoGerenciar').value = ""; mudarAcaoGerenciar(); 
            document.getElementById('g_novaFreq').value = contratoGerenciar.frequencia || "MENSAL"; document.getElementById('g_novasParc').value = contratoGerenciar.qtd_parcelas || 1; 
            document.getElementById('modalGerenciar').classList.remove('hidden'); 
        }

        function mudarAcaoGerenciar() { 
            const a = document.getElementById('tipoAcaoGerenciar').value; 
            document.querySelectorAll('.gerenciar-view').forEach(v => v.classList.add('hidden')); 
            const b = document.getElementById('btnExecGerenciar'); 
            if(a) { document.getElementById(`view-${a}`).classList.remove('hidden'); b.classList.remove('hidden'); } else { b.classList.add('hidden'); } 
        }

        async function cobrarCliente(id) { 
            try { 
                const dev = ativosAtuais.find(c => c.id === id); 
                const linkPortal = `${API_BASE}/pagar.html?id=${dev.uuid}`;
                const msg = `Olá ${dev.nome.split(' ')[0]}, passando para lembrar do seu compromisso conosco no valor de R$ ${Number(dev.valor_total).toFixed(2)}.\n\nAcesse seu portal para regularizar:\n🔗 ${linkPortal}`; 
                await fetch(`${API_BASE}/enviar-zap-custom`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ numero: dev.telefone, mensagem: msg }) }); 
                showToast("Cobrança enviada com Link!"); 
            } catch(e) {
                showToast("Erro ao cobrar.", "error");
            } 
        }

        async function executarGerenciar() { 
            const a = document.getElementById('tipoAcaoGerenciar').value; 
            const btn = document.getElementById('btnExecGerenciar');
            btn.disabled = true; btn.innerHTML = "Processando...";
            try { 
                if(a === 'QUITAR') { 
                    await fetch(`${API_BASE}/dar-baixa-total`, { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({ id: contratoGerenciar.id }) }); 
                    showToast("Liquidação Concluída!"); 
                } 
                else if(a === 'BAIXA') { 
                    const v = document.getElementById('g_valorBaixa').value; 
                    if(!v) throw "Informe o valor."; 
                    await fetch(`${API_BASE}/pagamento-parcial`, { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({ id: contratoGerenciar.id, valorPago: v }) }); 
                    showToast("Baixa Registrada!"); 
                } 
                else if(a === 'ADIAR') { 
                    const d = document.getElementById('g_novaData').value; 
                    const e = document.getElementById('g_diaria').value; 
                    if(!d) throw "Selecione a data limite."; 
                    await fetch(`${API_BASE}/alterar-vencimento`, { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({ id: contratoGerenciar.id, novaData: d, taxaAdicional: e }) }); 
                    showToast("Vencimento Prorrogado!"); 
                } 
                else if(a === 'RENEGOCIAR') { 
                    const nV = document.getElementById('g_novoValor').value; 
                    const nF = document.getElementById('g_novaFreq').value; 
                    const nP = document.getElementById('g_novasParc').value; 
                    if(!nV) throw "Informe o novo total."; 
                    await fetch(`${API_BASE}/renegociar-divida`, { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({ id: contratoGerenciar.id, novoValor: nV, frequencia: nF, qtd_parcelas: nP }) }); 
                    showToast("Contrato Renegociado!"); 
                } 
                fecharModais(); carregarAberto(); 
            } catch(e) { 
                showToast(typeof e === 'string' ? e : "Erro na operação", "error"); 
            } finally {
                btn.disabled = false; btn.innerHTML = 'Confirmar Operação <i class="fa-solid fa-bolt"></i>';
            }
        }

        function setFiltroRelatorio(t) { 
            document.querySelectorAll('.btn-filtro').forEach(btn => { btn.classList.remove('border-purple-500', 'bg-purple-600/20', 'text-purple-400'); btn.classList.add('border-white/5', 'bg-slate-800/80', 'text-slate-400'); });
            document.getElementById('btnFiltro' + t).classList.add('border-purple-500', 'bg-purple-600/20', 'text-purple-400');
            const hj = new Date(); let inicio = new Date(); inicio.setDate(1); 
            if(t === 'tri') inicio.setMonth(hj.getMonth() - 2); if(t === 'ano') inicio.setMonth(0); 
            document.getElementById('relDataInicio').value = inicio.toISOString().split('T')[0]; document.getElementById('relDataFim').value = hj.toISOString().split('T')[0]; 
            gerarRelatorioPeriodo(); 
        }

        async function gerarRelatorioPeriodo() { 
            const di = document.getElementById('relDataInicio').value; const df = document.getElementById('relDataFim').value; 
            const btn = document.getElementById('btnFiltrarRel');
            if(!di || !df) return showToast("Selecione o período completo!", "error"); 
            
            btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i>';
            try { 
                const res = await fetch(`${API_BASE}/relatorio-periodo`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ dataInicio: di, dataFim: df }) }); 
                if(res.ok) { 
                    const d = await res.json(); 
                    document.getElementById('relTotEmprestado').innerText = formatBRL(d.totalEmprestado); 
                    document.getElementById('relTotRecebido').innerText = formatBRL(d.totalRecebido); 
                    document.getElementById('relJurosAtraso').innerText = formatBRL(d.jurosAtrasoGerado); 
                    document.getElementById('relQtdAtrasados').innerText = d.qtdAtrasados; 
                    document.getElementById('relQtdEmprestimos').innerText = d.qtdEmprestimos; 
                    document.getElementById('relQtdBloqueados').innerText = d.qtdBloqueados; 
                    document.getElementById('boxResultadosRelatorio').classList.remove('hidden'); 
                } 
            } catch(e) {
                showToast("Erro ao compilar", "error");
            } finally {
                btn.innerHTML = '<i class="fa-solid fa-filter mr-2"></i> Filtrar Período';
            }
        }

        async function abrirRelatorio(id) {
            try {
                // Removemos o envio manual de Headers aqui! 
                // O Interceptador (window.fetch modificado) já cuida disso sozinho em segundo plano.
                const res = await fetch(`${API_BASE}/relatorio-cliente/${id}`);

                if (!res.ok) throw new Error("Erro ao buscar dados");

                const data = await res.json();

                if (!data || !data.cliente) {
                    throw new Error("Dados do relatório inválidos.");
                }

                auditorAtual = data.cliente;
                const c = data.cliente;

                // -------------------------
                // DADOS PRINCIPAIS
                // -------------------------
                document.getElementById('rel-nome').innerText = escapeHTML(c.nome);
                document.getElementById('rel-cpf-view').innerHTML = `
                    <span>
                        CPF: ${escapeHTML(c.cpf)} |
                        INDICADO:
                        <b class="text-white">
                            ${escapeHTML(c.indicado_por) || 'DIRETO'}
                        </b>
                    </span>
                `;

                // -------------------------
                // ESTATÍSTICAS
                // -------------------------
                const est = data.estatisticas || {};

                document.getElementById('rel-stats').innerHTML = `
                    <div class="bg-blue-600/10 p-5 rounded-3xl border border-blue-500/10">
                        <p class="text-[8px] uppercase text-blue-400 font-black">Histórico Vitalício</p>
                        <h3 class="text-xl font-black text-white italic mt-1">
                            ${formatBRL(est.totalPegoHistorico || 0)}
                        </h3>
                    </div>

                    <div class="bg-emerald-500/10 p-5 rounded-3xl border border-emerald-500/10">
                        <p class="text-[8px] uppercase text-emerald-500 font-black">Juros Pagos</p>
                        <h3 class="text-xl font-black text-emerald-400 italic mt-1">
                            ${formatBRL(est.jurosPagos || 0)}
                        </h3>
                    </div>

                    <div class="bg-orange-500/10 p-5 rounded-3xl border border-orange-500/10">
                        <p class="text-[8px] uppercase text-orange-400 font-black">Score Atual</p>
                        <h3 class="text-xl font-black text-orange-400 italic mt-1">
                            ${est.scoreAtual || 0} pts
                        </h3>
                    </div>

                    <div class="bg-slate-800 p-5 rounded-3xl border border-slate-700">
                        <p class="text-[8px] uppercase text-slate-400 font-black">Atraso Corrente</p>
                        <h3 class="text-xl font-black text-white italic mt-1">
                            ${est.atrasos || 0} d
                        </h3>
                    </div>
                `;

                // -------------------------
                // REFERÊNCIAS
                // -------------------------
                document.getElementById('v_ref1_nome').innerText = escapeHTML(c.referencia1_nome) || 'N/A';
                document.getElementById('v_ref1_tel').innerText  = escapeHTML(c.referencia1_tel)  || 'N/A';
                document.getElementById('v_ref2_nome').innerText = escapeHTML(c.referencia2_nome) || 'N/A';
                document.getElementById('v_ref2_tel').innerText  = escapeHTML(c.referencia2_tel)  || 'N/A';

                // -------------------------
                // IMAGENS
                // -------------------------
                document.getElementById('v_img_s').src = c.url_selfie     || imgFallback;
                document.getElementById('v_img_d').src = c.url_documento  || imgFallback;
                document.getElementById('v_img_r').src = c.url_residencia || imgFallback;
                document.getElementById('v_img_c').src = c.url_casa       || imgFallback;

                // -------------------------
                // HISTÓRICO (PROTEGIDO)
                // -------------------------
                const logs = Array.isArray(data.historico) ? data.historico : [];

                document.getElementById('rel-logs').innerHTML =
                    logs.length > 0
                        ? logs.map(l => `
                            <div class="flex justify-between p-4 bg-slate-900/50 rounded-2xl mb-2 border border-white/5">
                                <div>
                                    <p class="text-[9px] font-black text-blue-500 uppercase tracking-widest">
                                        ${escapeHTML(l.evento)}
                                    </p>
                                    <p class="text-[10px] text-slate-400 mt-1">
                                        ${escapeHTML(l.detalhes)}
                                    </p>
                                </div>
                                <p class="text-[8px] font-bold text-slate-600">
                                    ${new Date(l.created_at).toLocaleDateString('pt-BR')}
                                </p>
                            </div>
                        `).join('')
                        : '<p class="text-center py-6 text-[10px] uppercase font-black opacity-20">Sem histórico de eventos.</p>';

                // -------------------------
                // ABRE MODAL
                // -------------------------
                document.getElementById('modalRelatorio').classList.remove('hidden');

            } catch (e) {
                console.error(e);
                showToast(e.message || "Erro ao abrir relatório.", "error");
            }
        }

        async function editarIndicadorDoCliente(id) { const novo = prompt("Qual o nome do novo Indicador? (Deixe em branco para DIRETO)"); if(novo !== null) { await fetch(`${API_BASE}/editar-indicador`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ id, novoIndicador: novo.toUpperCase() || 'DIRETO' }) }); showToast("Parceiro Alterado!"); abrirRelatorio(id); } }
        async function abrirZapCustom() { if(!auditorAtual) return; const msg = prompt("Digite a Mensagem para o Robô enviar:"); if(msg) { await fetch(`${API_BASE}/enviar-zap-custom`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ numero: auditorAtual.telefone, mensagem: msg }) }); showToast("ZAP Enviado!"); } }

        async function carregarTodosAuditores() { try { const res = await fetch(`${API_BASE}/clientes-geral`); todosAuditores = await res.json(); filtrarClientes(); } catch(e) {} }
        
        function filtrarClientes() { 
            const termo = document.getElementById('buscaCliente').value.toLowerCase(); 
            const termoLimpo = termo.replace(/\D/g, ''); 
            
            document.getElementById('listaAuditores').innerHTML = todosAuditores.filter(c => {
                const checkNome = c.nome.toLowerCase().includes(termo);
                const checkCpfFormatado = c.cpf.includes(termo);
                const checkCpfLimpo = termoLimpo.length > 0 ? c.cpf.includes(termoLimpo) : false; 
                return checkNome || checkCpfFormatado || checkCpfLimpo;
            }).map(c => `<div class="bg-slate-900/50 p-6 rounded-3xl border border-white/5 flex justify-between items-center cursor-pointer hover:border-blue-500 transition-colors" onclick="abrirRelatorio(${c.id})"><div><h4 class="text-sm font-black text-white uppercase">${escapeHTML(c.nome)}</h4><p class="text-[10px] text-slate-500 uppercase font-bold mt-1 tracking-widest">CPF: ${escapeHTML(c.cpf)} | Score: ${c.score}</p></div><i class="fa-solid fa-chevron-right text-slate-600"></i></div>`).join(''); 
        }

        async function carregarListaNegra() { try { const res = await fetch(`${API_BASE}/lista-negra`); const data = await res.json(); document.getElementById('containerListaNegra').innerHTML = data.map(l => `<div class="glass-card p-6 rounded-3xl border border-red-500/20 relative"><button onclick="removerLista('${escapeHTML(l.cpf)}')" class="absolute top-4 right-4 text-slate-500 hover:text-red-500 transition-colors"><i class="fa-solid fa-trash"></i></button><p class="text-sm font-black text-white">${escapeHTML(l.cpf)}</p><p class="text-[10px] text-red-400 mt-2 uppercase font-bold tracking-widest">${escapeHTML(l.motivo)}</p></div>`).join(''); } catch(e) {} }
        async function bloquearCpf() { const c = document.getElementById('lnCpf').value; const m = document.getElementById('lnMotivo').value; if(!c || !m) return showToast("Preencha CPF e Motivo para Banir", "error"); await fetch(`${API_BASE}/lista-negra`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ cpf: c, motivo: m }) }); showToast("CPF Banido do Sistema!"); document.getElementById('lnCpf').value=''; document.getElementById('lnMotivo').value=''; carregarListaNegra(); }
        async function removerLista(cpf) { if(!confirm("Deseja realmente remover o embargo deste CPF?")) return; await fetch(`${API_BASE}/lista-negra/${cpf}`, { method: 'DELETE' }); showToast("Embargo removido. Cidadão reabilitado!"); carregarListaNegra(); }

        async function carregarRanking() { try { const res = await fetch(`${API_BASE}/ranking-promotores`, { method: 'POST' }); const data = await res.json(); document.getElementById('listaRanking').innerHTML = data.map((r, i) => `<div class="glass-card p-6 rounded-3xl flex justify-between items-center ${i===0?'border-yellow-500/50':''}"><div class="flex items-center gap-4"><div class="w-10 h-10 rounded-full bg-slate-800 flex items-center justify-center font-black ${i===0?'text-yellow-500':'text-slate-400'} shadow-inner">${i+1}º</div><div><h4 class="text-sm font-black text-white uppercase">${escapeHTML(r.nome_promotor)}</h4><p class="text-[10px] text-slate-500 uppercase mt-1 tracking-widest">${r.quantidade_indicados} indicações convertidas</p></div></div><p class="text-xl font-black text-emerald-400 italic">${formatBRL(r.total_gerado)}</p></div>`).join(''); } catch(e) {} }
        async function salvarPromotor() { const c = document.getElementById('p_cpf').value.replace(/\D/g, ''); const n = document.getElementById('p_nome').value; if(!c||!n) return showToast("Preencha todos os campos do Promotor", "error"); await fetch(`${API_BASE}/cadastrar-promotor`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ cpf: c, nome: n }) }); showToast("Parceiro Vinculado ao Sistema!"); document.getElementById('p_cpf').value = ''; document.getElementById('p_nome').value = ''; carregarRanking(); }

        async function confirmarMigracao() { 
            const p = { 
                nome: document.getElementById('m_nome').value, 
                cpf: document.getElementById('m_cpf').value, 
                whatsapp: document.getElementById('m_zap').value, 
                valor_original: document.getElementById('m_orig').value, 
                saldo_atual: document.getElementById('m_atual').value, 
                vencimento: document.getElementById('m_venc').value 
            }; 
            
            if(!p.nome || !p.cpf || !p.valor_original || !p.saldo_atual || !p.vencimento) return showToast("Dados vitais incompletos.", "error"); 
            
            try {
                const res = await fetch(`${API_BASE}/migrar-devedor`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(p) }); 
                if(res.ok) {
                    showToast("Cliente e Dívida Migrados!"); 
                    document.getElementById('m_nome').value = ''; document.getElementById('m_cpf').value = ''; document.getElementById('m_zap').value = ''; document.getElementById('m_orig').value = ''; document.getElementById('m_atual').value = ''; document.getElementById('m_venc').value = '';
                    mudarAba('aberto'); 
                } else {
                    throw new Error("Erro no servidor");
                }
            } catch(e) {
                showToast("Erro ao tentar migrar", "error");
            }
        }

        function mudarAba(aba) { 
            document.querySelectorAll('.aba-content').forEach(s => s.classList.add('hidden')); 
            document.querySelectorAll('nav button').forEach(b => b.classList.remove('tab-active')); 
            document.getElementById(`aba-${aba}`).classList.remove('hidden'); 
            document.getElementById(`nav-${aba}`).classList.add('tab-active'); 
            
            if(aba === 'dashboard') carregarDash(); 
            if(aba === 'solicitacoes') carregarSoli(); 
            if(aba === 'aberto') carregarAberto(); 
            if(aba === 'relatorios') setFiltroRelatorio('mes'); 
            if(aba === 'clientes') carregarTodosAuditores(); 
            if(aba === 'lista-negra') carregarListaNegra(); 
            if(aba === 'ranking') carregarRanking(); 
        }
    </script>
</body>
</html>